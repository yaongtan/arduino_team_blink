<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLINK_web service</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            background-color: #f4f7f6; 
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; 
            margin: 0; 
            padding: 20px; 
            color: #333; 
        }
        .container { max-width: 1000px; margin: 0 auto; }
        
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 1.8rem; }

        /* 1. ì§„ë‹¨ ë©”ì‹œì§€ ì¹´ë“œ */
        .diagnosis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border-left: 10px solid #ccc;
            transition: all 0.3s ease;
        }
        .diagnosis-title { font-size: 1.6em; font-weight: bold; margin-bottom: 10px; }
        .diagnosis-text { font-size: 1.1em; line-height: 1.6; color: #555; }
        .recommendation { 
            margin-top: 15px; 
            padding: 15px; 
            background-color: #f8f9fa; 
            border-radius: 8px; 
            font-weight: bold; 
            color: #444; 
            display: inline-block;
            border: 1px solid #eee;
        }

        /* 2. ëœë¤ ë°ì´í„° ìƒì„± (ê°œë°œ ê³¼ì •ì— ì‚¬ìš© - ì‚­ì œ ì˜ˆì •) */
        .control-panel { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .control-title { margin-bottom: 15px; font-size: 0.95em; color: #666; font-weight: bold; }
        
        .date-picker {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-right: 10px;
            font-family: inherit;
        }

        button {
            padding: 12px 20px; 
            font-size: 15px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            color: white; 
            font-weight: bold; 
            margin: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        .btn-led { background: linear-gradient(135deg, #FF6384, #d63c5e); }
        .btn-rhythm { background: linear-gradient(135deg, #36A2EB, #258cd1); }

        /* 3. ê·¸ë˜í”„ ë ˆì´ì•„ì›ƒ */
        .chart-container { 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            margin-bottom: 20px; 
        }
        .chart-title { text-align: center; font-weight: bold; margin-bottom: 15px; color: #555; }
        .row { display: flex; gap: 20px; }
        .col { flex: 1; }
        @media (max-width: 768px) { .row { flex-direction: column; } }
    </style>
</head>
<body>

<div class="container">
    <h1>[ì˜¤ëŠ˜ì˜ ë¶„ì„ ë³´ê³ ì„œ]</h1>

    <!-- ì§„ë‹¨ ë©”ì‹œì§€ -->
    <div id="ai-message-box" class="diagnosis-card">
        <div class="diagnosis-title">ë°ì´í„° ë¶„ì„ ëŒ€ê¸° ì¤‘...</div>
        <div class="diagnosis-text">ì˜¤ëŠ˜ì˜ ê²Œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ê²Œì„ì„ ì§„í–‰í•˜ê³  ì˜¤ëŠ˜ì˜ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</div>
    </div>

    <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div class="control-panel">
        <div class="control-title">ë‚ ì§œ ì„¤ì •, ë²„íŠ¼ìœ¼ë¡œ ëœë¤ ë°ì´í„° ìƒì„± -> ê·¸ë˜í”„ í™•ì¸ (ì •í™•ë„/ê±¸ë¦° ì‹œê°„)</div>
        <input type="date" id="sim-date" class="date-picker">
        <br><br>
        <button class="btn-led" onclick="simulateGame('LED')">LED ê²Œì„ ê¸°ë¡ ì¶”ê°€</button>
        <button class="btn-rhythm" onclick="simulateGame('RHYTHM')">ë°•ì ê²Œì„ ê¸°ë¡ ì¶”ê°€</button>
    </div>

    <!-- ë©”ì¸ ê·¸ë˜í”„ -->
    <div class="chart-container">
        <div class="chart-title">ì¼ë³„ í‰ê·  ì •í™•ë„ ì¶”ì´ (%)</div>
        <canvas id="accuracyChart"></canvas>
    </div>

    <!-- ì„œë¸Œ ê·¸ë˜í”„ -->
    <div class="row">
        <div class="col chart-container">
            <div class="chart-title" style="color:#FF6384;">âš¡ ì¼ë³„ í‰ê·  LED ë°˜ì‘ ì†ë„ (ì´ˆ)</div>
            <canvas id="ledTimeChart"></canvas>
        </div>
        <div class="col chart-container">
            <div class="chart-title" style="color:#36A2EB;">â±ï¸ ì¼ë³„ í‰ê·  ë°•ì ê²Œì„ ì†Œìš” ì‹œê°„ (ì´ˆ)</div>
            <canvas id="rhythmTimeChart"></canvas>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, query, limitToLast } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // --- [A] Firebase ì„¤ì • ---
    const myKey = prompt("Enter apiKey :");     // ì‹¤í–‰í•  ë•Œ ë§ˆë‹¤ API í‚¤ ì…ë ¥ ë°›ê¸°
    if (!myKey) {
        alert("ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
        throw new Error("API key is required.");
    }

    const firebaseConfig = {
        apiKey: myKey,      // ì…ë ¥ë°›ì€ í‚¤
        authDomain: "blink-7a4c4.firebaseapp.com",
        databaseURL: "https://blink-7a4c4-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "blink-7a4c4",
        storageBucket: "blink-7a4c4.firebasestorage.app",
        messagingSenderId: "376747209878",
        appId: "1:376747209878:web:0d1d0baca00f5aa234beb7",
        measurementId: "G-RJ2SZLRRPT"
    };
    

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dataRef = ref(db, 'game_logs');

    // ë‚ ì§œ ì„ íƒê¸° ê¸°ë³¸ê°’ì„ ì˜¤ëŠ˜ë¡œ ì„¤ì •
    document.getElementById('sim-date').valueAsDate = new Date();

    // --- [B] ì°¨íŠ¸ ì„¤ì • (ì•„ì§ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ) ---
    const commonScales = {
        y: { beginAtZero: false }, // ì •í™•ë„ 0ë¶€í„° ì‹œì‘ X
        x: { 
            grid: { display: false } // ì„¸ë¡œì„  ìˆ¨ê¹€
        }
    };

    // ì •í™•ë„ ì°¨íŠ¸
    const accCtx = document.getElementById('accuracyChart').getContext('2d');
    // data: { labels: [(xì¶• : ë‚ ì§œ ë°°ì—´)], datasets: [ { label: 'LED', data: [(yì¶• ë°ì´í„° ë°°ì—´)] }, { label: 'ë°•ì', data: [(yì¶• ë°ì´í„° ë°°ì—´)] } ] }
    const accuracyChart = new Chart(accCtx, {
        type: 'line',
        data: { labels: [], datasets: [
            { label: 'LED ì •í™•ë„', borderColor: '#FF6384', backgroundColor: '#FF6384', data: [], tension: 0.3, pointRadius: 5 },
            { label: 'ë°•ì ì •í™•ë„', borderColor: '#36A2EB', backgroundColor: '#36A2EB', data: [], tension: 0.3, pointRadius: 5 }
        ]},
        options: { responsive: true, scales: { y: { min: 0, max: 100 } } } // ì´í›„ commonScales ì ìš© ì˜ˆì •
    });

    const ledTimeCtx = document.getElementById('ledTimeChart').getContext('2d');
    const ledTimeChart = new Chart(ledTimeCtx, {
        type: 'bar',
        data: { labels: [], datasets: [{ label: 'ë°˜ì‘ ì‹œê°„', backgroundColor: '#FF6384', data: [] }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    const rhythmTimeCtx = document.getElementById('rhythmTimeChart').getContext('2d');
    const rhythmTimeChart = new Chart(rhythmTimeCtx, {
        type: 'bar',
        data: { labels: [], datasets: [{ label: 'ì†Œìš” ì‹œê°„', backgroundColor: '#36A2EB', data: [] }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });


    // --- [C] ë°ì´í„° ìˆ˜ì‹  ë° ì²˜ë¦¬ (ì°¨íŠ¸ ê°±ì‹ ) ---

    onValue(query(dataRef, limitToLast(100)), (snapshot) => {
        // dbì—ì„œ ìµœê·¼ ë°ì´í„° ìˆ˜ì‹  (ìµœëŒ€ 100ê°œ)
        const data = snapshot.val();
        if (!data) return;

        // 1. ë‚ ì§œë³„ ê·¸ë£¹í™” (Grouping)
        // êµ¬ì¡°: { "12/15" : { LED: { accSum(ì •í™•ë„ í•©), timeSum(ì‹œê°„ í•©), count(ê²Œì„ íšŸìˆ˜) }, RHYTHM: { ... } }, ... }
        let dailyGroups = {};
        
        // 2. ì§„ë‹¨ìš© ë°ì´í„° ì €ì¥ (ì˜¤ëŠ˜ vs ê³¼ê±°)
        // historyAcc, historyTime: ê³¼ê±° ì •í™•ë„, ì‹œê°„ ë°°ì—´
        // todayAcc, todayTime: ì˜¤ëŠ˜ ì •í™•ë„, ì‹œê°„ ë°°ì—´
        let stats = {
            LED: { historyAcc: [], historyTime: [], todayAcc: [], todayTime: [] },
            RHYTHM: { historyAcc: [], historyTime: [], todayAcc: [], todayTime: [] }
        };

        // ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
        const today = new Date();
        today.setHours(0,0,0,0); 

        // ì‹œê°„ ìˆœì„œ ë°ì´í„° ì •ë ¬
        const sortedLogs = Object.values(data).sort((a, b) => a.timestamp - b.timestamp);

        sortedLogs.forEach(log => {
            const logDate = new Date(log.timestamp);
            // ë‚ ì§œ í‚¤ ìƒì„± (ì˜ˆ: "12/15")
            const dateKey = `${logDate.getMonth()+1}/${logDate.getDate()}`;
            
        // [ê·¸ë˜í”„ ìš©] ë‚ ì§œ ë³„ ê·¸ë£¹í™”
            if (!dailyGroups[dateKey]) {
                dailyGroups[dateKey] = { 
                    LED: { accSum: 0, timeSum: 0, count: 0 }, 
                    RHYTHM: { accSum: 0, timeSum: 0, count: 0 } 
                };
            }
            // ë‚ ì§œ ë³„ ë°ì´í„° ëˆ„ì  ë¡œì§
            const group = dailyGroups[dateKey][log.game_type];
            if (group) {
                group.accSum += parseFloat(log.accuracy);
                group.timeSum += parseFloat(log.play_time);
                group.count += 1;
            }

        // [ì§„ë‹¨ ìš©] ì˜¤ëŠ˜ / ê³¼ê±° ë°ì´í„° ë¶„ë¦¬
            const isToday = logDate >= today;
            if (stats[log.game_type]) {     // ìœ íš¨í•œ ê²Œì„ íƒ€ì…ì¸ ê²½ìš°, íƒ€ì…ë³„ë¡œ (today / history)(Acc/Time)ë¡œ êµ¬ë¶„í•´ì„œ ë°ì´í„° ì¶”ê°€
                const targetAcc = isToday ? stats[log.game_type].todayAcc : stats[log.game_type].historyAcc;
                const targetTime = isToday ? stats[log.game_type].todayTime : stats[log.game_type].historyTime;
                
                targetAcc.push(parseFloat(log.accuracy));   // ì •í™•ë„ ì¶”ê°€
                targetTime.push(parseFloat(log.play_time)); // ì‹œê°„ ì¶”ê°€
            }
        });

        // 3. í‰ê·  ê³„ì‚°
        let chartLabels = Object.keys(dailyGroups);     // dailyGroupsì˜ í‚¤(ë‚ ì§œ) ì¶”ì¶œí•œ ë°°ì—´
        let accLedAvg = [], accRhythmAvg = [];          // ì •í™•ë„ í‰ê·  ë°°ì—´
        let timeLedAvg = [], timeRhythmAvg = [];        // ì‹œê°„ í‰ê·  ë°°ì—´

        chartLabels.forEach(date => {
            const dayData = dailyGroups[date];          // í•´ë‹¹ ë‚ ì§œ ë°ì´í„°

        // [LED í‰ê·  ê³„ì‚°]
            if (dayData.LED.count > 0) {
                accLedAvg.push((dayData.LED.accSum / dayData.LED.count).toFixed(1));
                timeLedAvg.push((dayData.LED.timeSum / dayData.LED.count).toFixed(1));
            } else {
                // ë°ì´í„° ì—†ìœ¼ë©´ null ì¶”ê°€
                accLedAvg.push(null);
                timeLedAvg.push(null);
            }

        // [Rhythm í‰ê·  ê³„ì‚°]
            if (dayData.RHYTHM.count > 0) {
                accRhythmAvg.push((dayData.RHYTHM.accSum / dayData.RHYTHM.count).toFixed(1));
                timeRhythmAvg.push((dayData.RHYTHM.timeSum / dayData.RHYTHM.count).toFixed(1));
            } else {
                // ë°ì´í„° ì—†ìœ¼ë©´ null ì¶”ê°€
                accRhythmAvg.push(null);
                timeRhythmAvg.push(null);
            }
        });

        // 4. ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬)
        accuracyChart.data.labels = chartLabels;                // xì¶• : ë‚ ì§œ
        accuracyChart.data.datasets[0].data = accLedAvg;        // dataset[0] : LED ì •í™•ë„
        accuracyChart.data.datasets[1].data = accRhythmAvg;     // dataset[1] : ë°•ì ì •í™•ë„
        accuracyChart.update();                                 // ê·¸ë˜í”„ ê·¸ë¦¬ê¸°

        // LED ë°˜ì‘ì†ë„ ê·¸ë˜í”„
        ledTimeChart.data.labels = chartLabels;                 // xì¶• : ë‚ ì§œ (LED, ë°•ì ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ê¸°ë¡ì´ ìˆë‹¤ë©´ ë‚ ì§œ ëª¨ë‘ í‘œì‹œí•¨)
        ledTimeChart.data.datasets[0].data = timeLedAvg;        // yì¶•: LED ì‹œê°„ ë°ì´í„° (ì—†ëŠ” ë‚ ì€ ë¹ˆì¹¸)
        ledTimeChart.update();                                  // ê·¸ë˜í”„ ê·¸ë¦¬ê¸°

        rhythmTimeChart.data.labels = chartLabels;              // xì¶• : ë‚ ì§œ (LED, ë°•ì ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ê¸°ë¡ì´ ìˆë‹¤ë©´ ë‚ ì§œ ëª¨ë‘ í‘œì‹œí•¨)
        rhythmTimeChart.data.datasets[0].data = timeRhythmAvg;  // yì¶•: ë°•ì ì‹œê°„ ë°ì´í„° (ì—†ëŠ” ë‚ ì€ ë¹ˆì¹¸)
        rhythmTimeChart.update();                               // ê·¸ë˜í”„ ê·¸ë¦¬ê¸°

        // 5. ì»¨ë””ì…˜ ì§„ë‹¨ ì‹¤í–‰
        runDiagnosis(stats);
    });

    // í‰ê·  êµ¬í•˜ëŠ” í•¨ìˆ˜ ì •ì˜ (ë¦¬ìŠ¤íŠ¸ì— ë‚´ìš©ë¬¼ì´ ìˆì„ ë•Œ - ëˆ„ì í•© - ê°œìˆ˜ë¡œ ë‚˜ëˆ” / ì—†ì„ ë•Œ - 0 ë°˜í™˜)
    // ex) getAvg([10,20,30]) => 20
    const getAvg = (arr) => arr.length ? (arr.reduce((a,b)=>a+b,0) / arr.length) : 0;


    // --- [D] ì»¨ë””ì…˜ ì§„ë‹¨ ë¡œì§  ---
    function runDiagnosis(stats) {
        const msgBox = document.getElementById('ai-message-box');   // ë©”ì‹œì§€ ë°•ìŠ¤ ìš”ì†Œ
        const title = msgBox.querySelector('.diagnosis-title');     // ì œëª© ìš”ì†Œ
        const text = msgBox.querySelector('.diagnosis-text');       // ë³¸ë¬¸ ìš”ì†Œ

        // ì˜¤ëŠ˜ ë°ì´í„°ê°€ ì•„ì˜ˆ ì—†ëŠ” ê²½ìš°
        if (stats.LED.todayAcc.length === 0 && stats.RHYTHM.todayAcc.length === 0) {
            title.innerHTML = "ì˜¤ëŠ˜ì˜ ê¸°ë¡ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...";
            text.innerHTML = "ì˜¤ëŠ˜ì˜ ê²Œì„ì„ ì§„í–‰í•´ ì£¼ì„¸ìš”.";
            msgBox.style.borderLeftColor = "#ccc"; 
            msgBox.style.backgroundColor = "#fff";
            return;
        }

        // ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜ ì •ì˜
        const getScore = (today, history, isTime) => {
            const baseVal = history || (isTime ? 30 : 70);  // ê³¼ê±° ë°ì´í„° (ê³¼ê±° ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’(ì‹œê°„ 30ì´ˆ, ì ìˆ˜ 70ì ) ì‚¬ìš©)
            if (isTime) return today <= baseVal ? 1 : 0;    // ì‹œê°„ ì‘ìœ¼ë©´ 1
            return today >= baseVal ? 1 : 0;                // ì •í™•ë„ í¬ë©´ 1
        };

        // today í‰ê· ê°’ ê³„ì‚°
        const todayLedAcc = getAvg(stats.LED.todayAcc);
        const todayLedTime = getAvg(stats.LED.todayTime);
        const todayBeatAcc = getAvg(stats.RHYTHM.todayAcc);
        const todayBeatTime = getAvg(stats.RHYTHM.todayTime);

        // ê° í•­ëª©ë³„ ì ìˆ˜ ê³„ì‚° (ì˜¤ëŠ˜/ê³¼ê±° ë¹„êµ)
        const L_Acc = getScore(todayLedAcc, getAvg(stats.LED.historyAcc), false);
        const L_Time = getScore(todayLedTime, getAvg(stats.LED.historyTime), true);
        const B_Acc = getScore(todayBeatAcc, getAvg(stats.RHYTHM.historyAcc), false);
        const B_Time = getScore(todayBeatTime, getAvg(stats.RHYTHM.historyTime), true);

        // ì´ì  ê³„ì‚°
        const totalScore = L_Acc + L_Time + B_Acc + B_Time;
        const accScore = L_Acc + B_Acc;
        const timeScore = L_Time + B_Time;

        // ì ìˆ˜ì— ë”°ë¥¸ ë©”ì‹œì§€ ì„¤ì •
        if (totalScore >= 3) {
            title.innerHTML = "ğŸŒŸ ìµœìƒì˜ ì»¨ë””ì…˜ ğŸŒŸ";
            text.innerHTML = `ëª¸ë„ ë§ˆìŒë„ ì²­ì¶˜ì´ì‹œë„¤ìš”!<br><div class='recommendation'>ì¶”ì²œ í™œë™: ê°€ë²¼ìš´ ì‚°ì±…ì„ í•˜ì‹œê±°ë‚˜ ë°”ë‘‘/ì¥ê¸°ë¥¼ í•œ íŒ ë‘¬ë³´ì„¸ìš”!</div>`;
            msgBox.style.borderLeftColor = "#4CAF50"; 
            msgBox.style.backgroundColor = "#E8F5E9";
        } else if (totalScore === 0) {
            title.innerHTML = "ğŸ˜´ íœ´ì‹ì´ í•„ìš”í•œ í•˜ë£¨";
            text.innerHTML = `ì˜¤ëŠ˜ ëª¸ì´ ë¬´ê±°ìš°ì‹œì§„ ì•Šìœ¼ì‹ ê°€ìš”?<br><div class='recommendation'>ì¶”ì²œ í™œë™: ë¬´ë¦¬í•˜ì§€ ë§ˆì‹œê³  ë”°ëœ»í•œ ì°¨ì™€ í•¨ê»˜ íœ´ì‹ì„ ì·¨í•´ë³´ì„¸ìš”.</div>`;
            msgBox.style.borderLeftColor = "#F44336"; 
            msgBox.style.backgroundColor = "#FFEBEE";
        } else if (accScore === 2 && timeScore === 0) {
            title.innerHTML = "ğŸ¢ ì‹ ì¤‘í•œ í•˜ë£¨ ğŸ¢";
            text.innerHTML = `ë‚˜ë¹„ì²˜ëŸ¼ ë‚ ì•„ ë²Œì²˜ëŸ¼ ìœë‹¤!<br><div class='recommendation'>ì¶”ì²œ í™œë™: êµ³ì€ ëª¸ì„ í’€ì–´ì£¼ëŠ” ìŠ¤íŠ¸ë ˆì¹­ì´ í•„ìš”í•´ìš”. ê¸°ì§€ê°œë¥¼ í•œë²ˆ ì‹œì›í•˜ê²Œ ì¼œë³¼ê¹Œìš”?</div>`;
            msgBox.style.borderLeftColor = "#FF9800"; 
            msgBox.style.backgroundColor = "#FFF3E0";
        } else if (timeScore === 2 && accScore === 0) {
            title.innerHTML = "âš¡ ì¡°ê¸‰í•œ í•˜ë£¨ âš¡";
            text.innerHTML = `í‹€ë ¤ë„ ê´œì°®ì•„ìš”! í‰ì˜¨í•œ ë§ˆìŒì„ ê°€ì ¸ë³´ì„¸ìš”.<br><div class='recommendation'>ì¶”ì²œ í™œë™: ì°¨ë¶„í•œ ìŒì•…ê³¼ í•¨ê»˜ ì˜›ë‚  ì‚¬ì§„ì²©ì„ ì°¬ì°¬íˆ ë„˜ê²¨ë³´ë©° ì¶”ì–µ ì—¬í–‰ì„ ë– ë‚˜ë³´ì„¸ìš”.</div>`;
            msgBox.style.borderLeftColor = "#9C27B0"; 
            msgBox.style.backgroundColor = "#F3E5F5";
        } else {
            title.innerHTML = "ğŸ™‚ í‰ì˜¨í•œ í•˜ë£¨ ğŸ™‚";
            text.innerHTML = `ì˜¤ëŠ˜ë„ í•œê²°ê°™ì´ ê±´ê°•í•œ ëª¨ìŠµì´ì‹œêµ°ìš”!<br><div class='recommendation'>ì¶”ì²œ í™œë™: ê°€ì¡±ì´ë‚˜ ì¹œêµ¬ì—ê²Œ ì „í™”í•´ ë°˜ê°€ìš´ ëª©ì†Œë¦¬ë¥¼ ë“¤ì–´ë³´ì„¸ìš”.</div>`;
            msgBox.style.borderLeftColor = "#2196F3"; 
            msgBox.style.backgroundColor = "#E3F2FD";
        }
    }

    // --- [E] ëœë¤ ë°ì´í„° ìƒì„± (ê°œë°œ ê³¼ì •ì— ì‚¬ìš© - ì‚­ì œ ì˜ˆì •) ---
    window.simulateGame = function(type) {
        let baseTime = type === "LED" ? 20 : 45;                // LED: 20ì´ˆ, ë°•ì: 45ì´ˆ ê¸°ì¤€
        let finalTime = baseTime + (Math.random() * 20 - 5);    // -5ì´ˆ ~ +15ì´ˆ ëœë¤ ë³€ë™
        let acc = (50 + Math.random() * 50).toFixed(1);         // 50.0% ~ 100.0% ëœë¤ ì •í™•ë„

        const dateInput = document.getElementById('sim-date').value; // ì„ íƒí•œ ë‚ ì§œ
        const selectedDate = new Date(dateInput);                    // ë‚ ì§œ ê°ì²´ ìƒì„±
        
        // ë‚ ì§œì— ëœë¤ ì‹œê°„ì„ ì¶”ê°€í•´ì„œ ê²¹ì¹˜ì§€ ì•Šê²Œ í•¨ (í•˜ë£¨ì— ì—¬ëŸ¬ íŒ í•œ ê²ƒì²˜ëŸ¼)
        const randomHour = Math.floor(Math.random() * 12) + 9;  // 09ì‹œ ~ 21ì‹œ ì‚¬ì´
        const randomMin = Math.floor(Math.random() * 60);       // 00ë¶„ ~ 59ë¶„ ì‚¬ì´
        selectedDate.setHours(randomHour, randomMin, 0);        // ì‹œê°„ ì„¤ì •

        push(dataRef, {
            game_type: type,
            accuracy: parseFloat(acc),
            play_time: finalTime.toFixed(1),
            timestamp: selectedDate.getTime()
        });
    }
</script>
</body>
</html>
